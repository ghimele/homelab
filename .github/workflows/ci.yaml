---
name: HomeLab CI

on:  # yamllint disable-line rule:truthy
  push:
    paths-ignore:
      - '**/README.md'
      - 'assets/**'
      - 'docs/**'
  pull_request:
    paths-ignore:
      - '**/README.md'
      - 'assets/**'
      - 'docs/**'

jobs:
  # yamllint:
  #   name: üßπ yamllint
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: ‚§µÔ∏è Check out configuration from GitHub
  #       uses: actions/checkout@v5.0.0
  #     - name: üöÄ Run yamllint
  #       run: |
  #         yamllint .

  yaml-lint:
    uses: ./.github/workflows/yaml-lint.yaml

  ansible-lint:
    uses: ./.github/workflows/ansible-lint.yaml

  manifests:
    name: ‚ò∏ Validate Kubernetes manifests
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6
      - name: Setup yq
        uses: fluxcd/pkg/actions/yq@main
      - name: Setup kubeconform
        uses: fluxcd/pkg/actions/kubeconform@main
      - name: Setup kustomize
        uses: fluxcd/pkg/actions/kustomize@main
      - name: Validate manifests
        run: ./scripts/flux-validate.sh
